@model IEnumerable<CRM_TTV.tbUser>

@{
    ViewBag.Title = "QUẢN LÝ NHÂN VIÊN";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-content">
    <!-- BEGIN PAGE HEAD-->
    <div class="page-head">
        <!-- BEGIN PAGE TITLE -->
        <div class="page-title">
            <h1>QUẢN LÝ NHÂN VIÊN</h1>
        </div>
        <!-- END PAGE TITLE -->

    </div>
    <!-- END PAGE HEAD-->
    <!-- BEGIN PAGE BREADCRUMB -->
    <ul class="page-breadcrumb breadcrumb">
        <li>
            <a href="index.html">Home</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <span class="active">Page Layouts</span>
        </li>
    </ul>
    <!-- END PAGE BREADCRUMB -->
    <!-- BEGIN PAGE BASE CONTENT -->
    <div class="note note-info">
        <div class="row">
            <div class="col-md-12">
                <button class="btn btn-default" onclick="location.reload(true);"><i class="fa fa-refresh"></i>&nbsp;Nạp</button>
                <button class="btn btn-primary" data-toggle="modal" controller="Staffs" id="btnCreate" href="#modal"><i class="fa fa-plus"></i>&nbsp;Thêm</button>
                <button class="btn btn-warning" id="btnEdit" controller="Staffs" data-toggle="modal" href="#modal"><i class="fa fa-pencil"></i>&nbsp;Sửa</button>
                <button class="btn btn-danger" id="btnRemove" controller="Staffs" onclick="confirm('Bạn có chắc chắn xóa không?');"><i class="fa fa-remove"></i>&nbsp;Xóa</button>
                <button class="btn yellow" id="btnPassword" disabled controller="StaffsOther" data-toggle="modal" href="#modal"><i class="fa fa-key"></i>&nbsp;Mật khẩu</button>
                <button class="btn red" id="btnLock" disabled onclick="lockAccount(1)"><i class="fa fa-lock"></i>&nbsp;Khóa</button>
                <button class="btn red" id="btnUnLock" disabled onclick="lockAccount(0)"><i class="fa fa-unlock"></i>&nbsp;Mở khóa</button>
                <button class="btn grey" data-toggle="modal" id="btnPermission" onclick="loadRole('Roles', 'AuthorizationRole')" href="#modal"><i class="fa fa-registered"></i>&nbsp;Phân quyền</button>
                <a class="btn green" id="btnImport" data-toggle="modal" controller="StaffsOther" href="#modal"><i class="fa fa-upload"></i>&nbsp;Import</a>
                <button class="btn btn-info" id="btnExport" onclick="$('#exportForm').submit()"><i class="fa fa-download"></i>&nbsp;Export</button>
                @using (Html.BeginForm("ExportFile", "StaffsOther", FormMethod.Post, new { enctype = "multipart/form-data", id = "exportForm", style = "position: absolute" }))
                { }
                <button class="btn grey-cascade" controller="Staffs" data-toggle="modal" id="btnSearch"><i class="fa fa-search"></i>&nbsp;Search</button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="portlet light bordered">
                <div class="portlet-body">
                    <div class="table-responsive table-custom-format">
                        <table class="table table-striped table-bordered table-hover">

                            <thead>
                                <tr>
                                    <th id="ID" hidden="hidden"></th>
                                    <th class="table-checkbox">
                                        <input type="checkbox" id="allcb" name="allcb" onclick="SelectAllCb()" />
                                    </th>
                                    <th>Mã NV</th>
                                    <th>Họ tên</th>
                                    <th>Điện thoại 1</th>
                                    <th>Điện thoại 2</th>
                                    <th>Email</th>
                                    <th>Hình thức NV</th>
                                    <th>Trạng thái làm việc</th>
                                    <th>Chi nhánh</th>
                                    <th>Khối - phòng ban</th>
                                    <th>Bộ phận</th>
                                    <th>HĐ từ ngày</th>
                                    <th>HĐ đến ngày</th>
                                    <th>Số sổ BHXH</th>
                                    <th>Mã số thuế</th>
                                    <th>Tài khoản số</th>
                                    <th>Chi nhánh NH</th>
                                    <th>Trạng thái nhân viên</th>
                            </thead>

                            <tbody id='rootList'>

                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td><input id="@item.userID" type="checkbox" name="cb" onclick="CheckSelect()" /></td>
                                        <td>
                                            @item.code
                                        </td>
                                        <td>
                                            @item.fullName
                                        </td>
                                        <td>
                                            @item.phone
                                        </td>
                                        <td>
                                            @item.phone2
                                        </td>
                                        <td>
                                            @item.email
                                        </td>
                                        <td>
                                            @(item.tbCategory1 != null ? item.tbCategory1.name : "")
                                        </td>
                                        <td>
                                            @(item.tbCategory != null ? item.tbCategory.name : "")
                                        </td>
                                        <td>
                                            @(item.tbCompany != null ? item.tbCompany.name : "")
                                        </td>
                                        <td></td>
                                        <td>
                                            @item.department
                                        </td>
                                        <td>
                                            @string.Format("{0:dd-MM-yyyy}", item.HDLDStartDate)
                                        </td>
                                        <td>
                                            @string.Format("{0:dd-MM-yyyy}", item.HDLDEndDate)
                                        </td>
                                        <td>
                                            @item.codeBHXH
                                        </td>
                                        <td>
                                            @item.taxCode
                                        </td>
                                        <td></td>
                                        <td>
                                            @item.banking
                                        </td>
                                        <td></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    @Html.Raw(ViewBag.Paging)
                </div>
            </div>
            <div class="portlet light bordered">
                <div class="portlet-body">
                    <div class="tabbable-custom" id="tabbable-custom">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#Details" data-toggle="tab" id="tabthongtin">Thông tin</a>
                            </li>
                            <li>
                                <a href="#Documents" data-toggle="tab" id="tabhoso">Hồ sơ</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="Details" data-id="Details">
                            </div>
                            <div class="tab-pane" id="Documents" data-id="Documents">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @*Pupup modal inset update delete*@
    <div class="modal fade bs-modal-lg" id="modal" role="document" aria-hidden="true"></div>

</div>
<div id="popupData"></div>

@section scripts{
    <script>
        $("#btnPassword").click(function (partialView) {
            var selectedIDs = $('input:checkbox:checked', "#rootList").map(function () {
                return $(this).attr('id');
            }).get();

            var options = {};
            options.url = "/" + $(this).attr('controller') + "/password/" + selectedIDs;
            options.type = "GET";
            options.success = function (msg) {
                $("#modal").html(msg);
                $('.selectpicker').selectpicker({
                    liveSearch: true,
                    showSubtext: true
                });
            };
            options.error = function () {
                alert("Eror...!!!");
            };
            $.ajax(options);
        });

        $("#btnImport").click(function (partialView) {
            var options = {};
            options.url = "/" + $(this).attr('controller') + "/import/";
            options.type = "GET";
            options.success = function (msg) {
                $("#modal").html(msg);
                $('.selectpicker').selectpicker({
                    liveSearch: true,
                    showSubtext: true
                });
            };
            options.error = function () {
                alert("Eror...!!!");
            };
            $.ajax(options);
        });

        function lockAccount(i) {
            var dataPost = {
                i: i,
                id: $('input:checkbox:checked', "#rootList").attr('id')
            };
            $.ajax({
                type: "POST",
                url: '/StaffsOther/Lock',
                data: JSON.stringify(dataPost),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    toastr.success("Đã lưu...!!!", "Success");
                }
            });
        }
    </script>
}